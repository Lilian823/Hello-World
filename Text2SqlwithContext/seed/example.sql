SET FOREIGN_KEY_CHECKS=0;
DROP TABLE IF EXISTS patient_metrics;
DROP TABLE IF EXISTS medical_checkup;
DROP TABLE IF EXISTS patients;
SET FOREIGN_KEY_CHECKS=1;
-- 1. 首先创建表结构（保持不变）
CREATE TABLE patients (
    patient_id VARCHAR(20) PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    gender ENUM('男','女') NOT NULL,
    birth_date DATE NOT NULL,
    phone VARCHAR(20),
    address VARCHAR(200),
    blood_type ENUM('A','B','AB','O','未知'),
    rh_factor ENUM('阳性','阴性','未知'),
    allergy_history TEXT,
    chronic_diseases TEXT COMMENT '慢性病史',
    family_disease_history TEXT COMMENT '家族病史',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB CHARSET=utf8mb4;

CREATE TABLE medical_checkup (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    patient_id VARCHAR(20) NOT NULL COMMENT '患者唯一标识',
    name VARCHAR(50) NOT NULL COMMENT '患者姓名',  -- 已修改为name
    gender ENUM('男','女') NOT NULL COMMENT '性别',
    age INT NOT NULL COMMENT '年龄',
    checkup_date DATE NOT NULL COMMENT '检查日期',
    height DECIMAL(5,2) COMMENT '身高(cm)',
    weight DECIMAL(5,2) COMMENT '体重(kg)',
    waist_circumference DECIMAL(5,2) COMMENT '腰围(cm)',
    bmi DECIMAL(5,2) COMMENT '体质指数(kg/m²)',
    temperature DECIMAL(4,1) COMMENT '体温(℃)',
    pulse_rate INT COMMENT '脉率(次/分钟)',
    respiratory_rate INT COMMENT '呼吸频率(次/分钟)',
    blood_pressure VARCHAR(10) COMMENT '血压(mmHg)',
    fasting_glucose DECIMAL(5,2) COMMENT '空腹血糖(mmol/L)',
    hba1c DECIMAL(4,2) COMMENT '糖化血红蛋白(%)',
    total_cholesterol DECIMAL(5,2) COMMENT '总胆固醇(mmol/L)',
    triglycerides DECIMAL(5,2) COMMENT '甘油三酯(mmol/L)',
    hdl DECIMAL(5,2) COMMENT '高密度脂蛋白(mmol/L)',
    ldl DECIMAL(5,2) COMMENT '低密度脂蛋白(mmol/L)',
    alt INT COMMENT '谷丙转氨酶(U/L)',
    ast INT COMMENT '谷草转氨酶(U/L)',
    serum_creatinine DECIMAL(6,2) COMMENT '血清肌酐(μmol/L)',
    blood_urea DECIMAL(5,2) COMMENT '血尿素(mmol/L)',
    wbc DECIMAL(5,2) COMMENT '白细胞计数(×10⁹⁹/L)',
    rbc DECIMAL(5,2) COMMENT '红细胞计数(×10¹²/L)',
    hemoglobin DECIMAL(5,2) COMMENT '血红蛋白(g/L)',
    platelet_count DECIMAL(6,2) COMMENT '血小板计数(×10⁹⁹/L)',
    urine_protein ENUM('阴性','±','+','++','+++','++++') COMMENT '尿蛋白',
    urine_glucose ENUM('阴性','±','+','++','+++','++++') COMMENT '尿糖',
    vision_left DECIMAL(4,1) COMMENT '左眼视力(五分记录法)',
    vision_right DECIMAL(4,1) COMMENT '右眼视力(五分记录法)',
    hearing_status ENUM('正常','轻度下降','中度下降','重度下降') COMMENT '听力状况',
    ecg_result VARCHAR(100) COMMENT '心电图结果',
    ultrasound_abdomen VARCHAR(200) COMMENT '腹部超声结果',
    ultrasound_cardiac VARCHAR(200) COMMENT '心脏超声结果',
    carotid_ultrasound VARCHAR(200) COMMENT '颈动脉超声',
    smoking_status ENUM('从不吸烟','已戒烟','吸烟') COMMENT '吸烟状态',
    daily_smoking INT COMMENT '日吸烟量(支)',
    alcohol_consumption ENUM('从不饮酒','已戒酒','偶尔饮酒','经常饮酒') COMMENT '饮酒频率',
    exercise_frequency ENUM('每天','每周≥3次','偶尔','不锻炼') COMMENT '锻炼频率',
    self_care_ability ENUM('完全自理','轻度依赖','中度依赖','不能自理') COMMENT '生活自理能力',
    cognitive_status ENUM('正常','轻度障碍','中度障碍','重度障碍') COMMENT '认知功能',
    diagnosis_summary TEXT COMMENT '初步诊断摘要',
    risk_assessment TEXT COMMENT '健康风险评估',
    doctor_advice TEXT COMMENT '健康指导建议',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '记录创建时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='综合健康体检记录表';

ALTER TABLE medical_checkup 
ADD FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE;

CREATE TABLE patient_metrics (
    record_id INT AUTO_INCREMENT PRIMARY KEY,
    patient_id VARCHAR(10) NOT NULL COMMENT '患者唯一标识',
    metric_name VARCHAR(30) NOT NULL COMMENT '指标名称（如血糖、血压）',
    metric_value DECIMAL(10,2) NOT NULL COMMENT '数值结果',
    unit VARCHAR(10) COMMENT '单位（如mmol/L、mmHg）',
    checkup_date DATE NOT NULL COMMENT '检测日期（折线图X轴）',
    reference_range VARCHAR(30) COMMENT '参考范围',
    FOREIGN KEY (patient_id) REFERENCES patients(patient_id)
) ENGINE=InnoDB CHARSET=utf8mb4;

ALTER TABLE patient_metrics ADD INDEX idx_patient_metric (patient_id, metric_name, checkup_date);

-- 2. 先插入patients表数据
INSERT INTO patients (
    patient_id, name, gender, birth_date, phone, address, 
    blood_type, rh_factor, allergy_history, chronic_diseases, family_disease_history
) VALUES
('P10001', '张伟', '男', '1978-05-12', '13800138001', '北京市朝阳区建国路88号', 'A', '阳性', '青霉素', '高血压', '父亲糖尿病'),
('P10002', '李芳', '女', '1961-11-03', '13800138002', '上海市浦东新区张江高科技园区', 'B', '阳性', '海鲜', '2型糖尿病', '母亲冠心病'),
('P10003', '王磊', '男', '1985-08-25', '13800138003', '广州市天河区体育西路', 'O', '阳性', '无', '无', '无'),
('P10004', '刘洋', '女', '1952-07-19', '13800138004', '深圳市南山区科技园', 'AB', '阳性', '花粉', '冠心病', '父亲高血压'),
('P10005', '陈明', '男', '1970-12-30', '13800138005', '成都市武侯区人民南路', 'A', '阳性', '阿司匹林', '代谢综合征', '父母均高血压'),
('P10006', '赵静', '女', '1994-02-08', '13800138006', '杭州市西湖区文三路', 'B', '阳性', '无', '无', '无'),
('P10007', '周强', '男', '1958-09-15', '13800138007', '武汉市洪山区珞喻路', 'O', '阳性', '鸡蛋', '高血压1级', '无'),
('P10008', '孙婷', '女', '1982-04-22', '13800138008', '西安市雁塔区小寨路', 'A', '阳性', '无', '甲状腺功能减退', '母亲甲状腺疾病'),
('P10009', '郑浩', '男', '1967-10-17', '13800138009', '重庆市渝中区解放碑', 'AB', '阳性', '头孢类', '糖尿病肾病', '父亲尿毒症'),
('P10010', '吴琳', '女', '1989-06-28', '13800138010', '南京市鼓楼区中山路', 'B', '阳性', '无', '缺铁性贫血', '无'),
('P10011', '林涛', '男', '1977-03-14', '13800138011', '天津市和平区南京路', 'O', '阳性', '无', '轻度脂肪肝', '无'),
('P10012', '徐雅', '女', '1969-07-21', '13800138012', '苏州市工业园区金鸡湖大道', 'A', '阳性', '尘螨', '高血压2级', '母亲中风'),
('P10013', '高飞', '男', '1992-11-09', '13800138013', '长沙市岳麓区麓山南路', 'B', '阳性', '无', '无', '无'),
('P10014', '韩梅', '女', '1962-12-05', '13800138014', '郑州市金水区花园路', 'AB', '阳性', '磺胺类', '冠心病', '父亲心肌梗死'),
('P10015', '唐磊', '男', '1975-09-30', '13800138015', '宁波市鄞州区钱湖北路', 'O', '阳性', '无', '代谢综合征', '无'),
('P10016', '宋佳', '女', '1986-01-18', '13800138016', '青岛市市南区香港中路', 'A', '阳性', '无', '甲状腺结节', '母亲乳腺癌'),
('P10017', '谢峰', '男', '1981-08-07', '13800138017', '大连市中山区人民路', 'B', '阳性', '坚果', '高尿酸血症', '无'),
('P10018', '郑琳', '女', '1996-04-03', '13800138018', '厦门市思明区湖滨南路', 'O', '阳性', '无', '无', '无'),
('P10019', '董超', '男', '1964-06-27', '13800138019', '济南市历下区泺源大街', 'AB', '阳性', '无', '高血压2级', '父亲糖尿病'),
('P10020', '周敏', '女', '1988-10-11', '13800138020', '福州市鼓楼区五四路', 'A', '阳性', '无', '缺铁性贫血', '无'),
('P10021', '吴强', '男', '1973-02-23', '13800138021', '哈尔滨市南岗区西大直街', 'B', '阳性', '无', '颈动脉斑块', '无'),
('P10022', '孙丽', '女', '1957-05-16', '13800138022', '长春市朝阳区工农大路', 'O', '阳性', '造影剂', '心力衰竭', '无'),
('P10023', '王浩', '男', '1984-09-08', '13800138023', '沈阳市和平区太原街', 'A', '阳性', '无', '支气管哮喘', '母亲过敏体质'),
('P10024', '赵静', '女', '1970-12-14', '13800138024', '石家庄市长安区中山东路', 'AB', '阳性', '无', '2型糖尿病', '无'),
('P10025', '钱伟', '男', '1979-07-05', '13800138025', '太原市小店区长风街', 'O', '阳性', '无', '酒精性肝病', '父亲肝硬化'),
('P10026', '黄燕', '女', '1993-03-19', '13800138026', '合肥市蜀山区长江西路', 'A', '阳性', '无', '妊娠期（12周）', '无'),
('P10027', '刘洋', '男', '1967-08-22', '13800138027', '南昌市东湖区阳明路', 'B', '阳性', '无', '慢性肾病3期', '无'),
('P10028', '陈雪', '女', '1982-11-25', '13800138028', '昆明市五华区东风西路', 'O', '阳性', '无', '子宫肌瘤', '无'),
('P10029', '杨帆', '男', '1989-04-30', '13800138029', '贵阳市云岩区中华北路', 'A', '阳性', '无', '高甘油三酯血症', '无'),
('P10030', '朱琳', '女', '1974-01-07', '13800138030', '兰州市城关区庆阳路', 'AB', '阳性', '无', '骨质疏松', '母亲骨质疏松');

-- 3. 再插入medical_checkup表数据（已将所有patient_name改为name）
INSERT INTO medical_checkup (
    patient_id, name, gender, age, checkup_date, height, weight, waist_circumference, 
    bmi, blood_pressure, fasting_glucose, hba1c, total_cholesterol, triglycerides, hdl, ldl,
    alt, ast, serum_creatinine, wbc, hemoglobin, urine_protein, ecg_result, 
    smoking_status, alcohol_consumption, diagnosis_summary, doctor_advice
) VALUES
('P10001', '张伟', '男', 45, '2023-03-10', 172.5, 70.2, 85.0, 23.6, '118/76', 5.2, 5.8, 4.8, 1.2, 1.3, 2.9, 22, 18, 68.5, 6.8, 145, '阴性', '窦性心律', '已戒烟', '偶尔饮酒', '血脂轻度升高', '建议低脂饮食，3个月后复查血脂'),
('P10002', '李芳', '女', 62, '2023-04-15', 158.0, 68.5, 92.0, 27.4, '145/92', 7.8, 7.2, 6.1, 2.8, 1.1, 4.5, 35, 41, 89.2, 7.5, 130, '++', 'ST段压低', '吸烟', '从不饮酒', '高血压2级，糖尿病', '降压降糖治疗，每周监测血压血糖'),
('P10003', '王磊', '男', 38, '2023-05-20', 178.0, 77.1, 88.0, 24.3, '122/80', 5.6, 5.5, 5.0, 1.5, 1.2, 3.2, 25, 23, 75.0, 6.2, 155, '阴性', '正常心电图', '从不吸烟', '偶尔饮酒', '健康', '保持当前生活方式'),
('P10004', '刘洋', '女', 71, '2023-06-18', 155.5, 60.0, 86.0, 24.8, '138/85', 6.1, 6.0, 5.5, 1.8, 1.4, 3.6, 28, 30, 92.0, 5.9, 142, '+', '房性早搏', '已戒烟', '从不饮酒', '冠心病史稳定期', '继续服用阿司匹林和他汀'),
('P10005', '陈明', '男', 53, '2023-07-22', 170.0, 85.3, 102.0, 29.5, '150/94', 8.2, 7.8, 5.9, 3.1, 0.9, 4.2, 48, 52, 101.5, 8.1, 162, '+++', '左心室肥厚', '吸烟', '经常饮酒', '代谢综合征', '减重10kg，戒烟限酒，降脂治疗'),
('P10006', '赵静', '女', 29, '2023-08-05', 165.0, 55.0, 74.0, 20.2, '110/70', 4.9, 5.0, 4.0, 0.9, 1.6, 2.1, 19, 21, 55.0, 6.0, 128, '阴性', '正常心电图', '从不吸烟', '从不饮酒', '健康', '建议每年体检'),
('P10007', '周强', '男', 67, '2023-09-11', 175.0, 80.0, 98.0, 26.1, '142/88', 6.5, 6.3, 4.9, 1.6, 1.0, 3.3, 37, 40, 95.0, 7.8, 148, '±', 'T波低平', '已戒烟', '偶尔饮酒', '高血压1级', '低盐饮食，每日监测血压'),
('P10008', '孙婷', '女', 41, '2023-10-19', 163.0, 62.0, 80.0, 23.3, '125/82', 5.4, 5.4, 4.5, 1.3, 1.3, 2.7, 26, 24, 70.0, 6.5, 136, '阴性', '窦性心动过缓', '从不吸烟', '偶尔饮酒', '甲状腺功能减退', '继续服用优甲乐50μg'),
('P10009', '郑浩', '男', 58, '2023-11-25', 180.0, 90.0, 104.0, 27.8, '148/92', 7.2, 6.9, 5.8, 2.5, 1.0, 4.0, 50, 48, 105.0, 8.5, 158, '++', 'ST-T改变', '吸烟', '经常饮酒', '糖尿病肾病Ⅲ期', '胰岛素治疗+ACEI类药物'),
('P10010', '吴琳', '女', 35, '2023-12-30', 168.0, 58.0, 76.0, 20.6, '116/75', 5.1, 5.2, 4.2, 1.0, 1.5, 2.3, 23, 20, 60.0, 5.5, 132, '阴性', '正常心电图', '从不吸烟', '从不饮酒', '轻度贫血', '补充铁剂和维生素C'),
('P10011', '林涛', '男', 48, '2025-07-10', 175.0, 78.0, 94.0, 25.5, '132/84', 6.0, 5.9, 5.2, 1.6, 1.2, 3.4, 28, 26, 75.0, 7.0, 148, '阴性', '正常心电图', '已戒烟', '偶尔饮酒', '轻度脂肪肝', '低脂饮食，加强有氧运动'),
('P10012', '徐雅', '女', 56, '2025-07-18', 162.0, 65.0, 88.0, 24.8, '148/92', 7.5, 7.1, 5.8, 2.2, 1.0, 4.0, 42, 38, 88.0, 8.2, 136, '+', '左束支传导阻滞', '吸烟', '从不饮酒', '高血压合并糖尿病', '调整胰岛素剂量，每日监测血压'),
('P10013', '高飞', '男', 33, '2025-07-25', 180.0, 75.0, 84.0, 23.1, '120/78', 5.0, 5.1, 4.3, 1.1, 1.5, 2.5, 22, 20, 62.0, 6.1, 152, '阴性', '窦性心律', '从不吸烟', '偶尔饮酒', '健康', '保持当前生活方式'),
('P10014', '韩梅', '女', 63, '2025-08-01', 158.0, 62.0, 86.0, 24.8, '142/88', 6.8, 6.5, 5.6, 1.9, 1.1, 3.8, 36, 34, 90.0, 7.5, 130, '++', 'ST段压低', '已戒烟', '偶尔饮酒', '冠心病稳定期', '继续服用β受体阻滞剂'),
('P10015', '唐磊', '男', 50, '2025-08-05', 172.0, 85.0, 100.0, 28.7, '154/96', 8.0, 7.5, 6.2, 3.0, 0.8, 4.5, 55, 50, 98.0, 8.8, 160, '+++', '左心室高电压', '吸烟', '经常饮酒', '代谢综合征', '减重8kg，戒烟限酒'),
('P10016', '宋佳', '女', 39, '2025-08-12', 166.0, 59.0, 78.0, 21.4, '118/76', 5.3, 5.3, 4.4, 1.2, 1.4, 2.6, 24, 22, 68.0, 6.3, 140, '阴性', '正常心电图', '从不吸烟', '从不饮酒', '甲状腺结节（良性）', '6个月后复查超声'),
('P10017', '谢峰', '男', 44, '2025-08-20', 178.0, 80.0, 92.0, 25.2, '130/82', 5.8, 5.7, 4.9, 1.5, 1.1, 3.2, 30, 28, 76.0, 7.2, 154, '±', '偶发房性早搏', '已戒烟', '偶尔饮酒', '高尿酸血症', '低嘌呤饮食，多饮水'),
('P10018', '郑琳', '女', 29, '2025-08-28', 165.0, 54.0, 72.0, 19.8, '112/70', 4.8, 4.9, 3.9, 0.8, 1.7, 1.9, 18, 17, 52.0, 5.8, 126, '阴性', '正常心电图', '从不吸烟', '从不饮酒', '健康', '建议每2年体检'),
('P10019', '董超', '男', 61, '2025-09-03', 170.0, 76.0, 96.0, 26.3, '146/90', 6.9, 6.6, 5.4, 2.0, 0.9, 3.9, 40, 42, 92.0, 8.0, 150, '+', 'T波倒置', '吸烟', '经常饮酒', '高血压2级', '起始氨氯地平治疗'),
('P10020', '周敏', '女', 37, '2025-09-10', 163.0, 60.0, 80.0, 22.6, '124/80', 5.2, 5.2, 4.5, 1.3, 1.3, 2.8, 25, 23, 66.0, 6.4, 138, '阴性', '窦性心律不齐', '从不吸烟', '偶尔饮酒', '缺铁性贫血', '补充铁剂+维生素B12'),
('P10021', '吴强', '男', 52, '2025-09-18', 176.0, 82.0, 98.0, 26.5, '136/84', 6.2, 6.0, 5.1, 1.7, 1.0, 3.5, 32, 30, 78.0, 7.3, 146, '阴性', '正常心电图', '已戒烟', '偶尔饮酒', '颈动脉斑块（稳定）', '继续他汀治疗，控制LDL<2.6'),
('P10022', '孙丽', '女', 68, '2025-10-05', 156.0, 63.0, 90.0, 25.9, '150/94', 7.2, 6.9, 5.7, 2.4, 0.9, 4.1, 45, 47, 95.0, 8.5, 134, '++', '房颤', '已戒烟', '从不饮酒', '心力衰竭NYHA II级', '利尿剂+ACEI优化治疗'),
('P10023', '王浩', '男', 41, '2025-11-12', 177.0, 74.0, 86.0, 23.6, '126/80', 5.5, 5.4, 4.6, 1.4, 1.2, 2.9, 26, 24, 70.0, 6.6, 150, '阴性', '正常心电图', '从不吸烟', '偶尔饮酒', '支气管哮喘（缓解期）', '避免冷空气刺激'),
('P10024', '赵静', '女', 55, '2025-12-20', 160.0, 67.0, 92.0, 26.2, '144/88', 6.7, 6.4, 5.3, 1.8, 1.0, 3.7, 38, 36, 86.0, 7.8, 142, '+', '一度房室传导阻滞', '吸烟', '从不饮酒', '2型糖尿病', '二甲双胍剂量增至1g bid'),
('P10025', '钱伟', '男', 46, '2025-09-25', 175.0, 82.0, 96.0, 26.8, '140/88', 6.3, 6.1, 5.4, 2.8, 1.0, 3.7, 65, 58, 110.0, 8.2, 152, '++', '非特异性ST-T改变', '吸烟', '经常饮酒', '酒精性肝病', '戒酒，保肝治疗，3个月后复查肝功能'),
('P10026', '黄燕', '女', 32, '2025-10-05', 163.0, 62.0, 82.0, 23.3, '120/78', 5.4, 5.3, 4.7, 1.5, 1.4, 2.8, 24, 22, 60.0, 7.1, 125, '阴性', '正常心电图', '从不吸烟', '从不饮酒', '妊娠期（12周）', '补充叶酸，定期产检'),
('P10027', '刘洋', '男', 58, '2025-10-15', 172.0, 74.0, 94.0, 25.0, '132/84', 6.8, 6.5, 5.2, 1.7, 1.0, 3.5, 38, 36, 150.0, 6.5, 135, '+', '非特异性T波改变', '已戒烟', '偶尔饮酒', '慢性肾病3期', '低蛋白饮食，控制血压<130/80'),
('P10028', '陈雪', '女', 43, '2025-11-02', 166.0, 64.0, 84.0, 23.2, '126/80', 5.6, 5.5, 4.8, 1.6, 1.3, 3.0, 26, 24, 72.0, 6.8, 130, '阴性', '正常心电图', '从不吸烟', '偶尔饮酒', '子宫肌瘤（3cm）', '每6个月妇科超声复查'),
('P10029', '杨帆', '男', 36, '2025-11-20', 178.0, 80.0, 92.0, 25.2, '128/82', 5.9, 5.7, 5.8, 3.2, 1.1, 3.9, 28, 26, 76.0, 7.0, 148, '阴性', '窦性心律', '从不吸烟', '偶尔饮酒', '高甘油三酯血症', '低脂饮食，加强运动，3个月后复查血脂'),
('P10030', '朱琳', '女', 51, '2025-12-10', 160.0, 58.0, 82.0, 22.7, '124/78', 5.5, 5.4, 4.9, 1.8, 1.2, 3.2, 25, 23, 68.0, 6.2, 120, '阴性', '正常心电图', '从不吸烟', '偶尔饮酒', '骨质疏松（T值-2.5）', '补充钙剂和维生素D，骨密度每年复查');


